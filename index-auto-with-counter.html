<!DOCTYPE html>
<html>
<head>
  <title>‡πÅ‡∏ä‡∏£‡πå‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</title>
</head>
<body>
  <h2>üìç ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì...</h2>
  <p id="status">‚è≥ ‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...</p>

  <script>
    let counter = localStorage.getItem("user_counter") || 0;
    counter++;
    localStorage.setItem("user_counter", counter);

    function getIPInfoAndSend(position) {
      fetch("https://ipapi.co/json/")
        .then(res => res.json())
        .then(ipinfo => {
          const data = {
            name: "‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà " + counter + " (" + ipinfo.city + ", " + ipinfo.region + ")",
            lat: position.coords.latitude,
            lng: position.coords.longitude,
            accuracy: position.coords.accuracy,
            timestamp: new Date().toISOString()
          };

          document.getElementById("status").innerText =
            `‚úÖ ‡∏™‡πà‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÅ‡∏•‡πâ‡∏ß: ${data.name} @ (${data.lat}, ${data.lng})`;

          fetch("http://localhost:3000/save-location", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
          });
        })
        .catch(() => {
          document.getElementById("status").innerText = "‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏à‡∏≤‡∏Å IP ‡πÑ‡∏î‡πâ";
        });
    }

    window.onload = function () {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(getIPInfoAndSend, () => {
          document.getElementById("status").innerText = "‚ùå ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á";
        }, {
          enableHighAccuracy: true
        });
      } else {
        document.getElementById("status").innerText = "‚ùå ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö GPS";
      }
    };
  </script>
</body>
</html>
